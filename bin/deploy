#!/usr/bin/php
<?

// -- BASICS

	define("ROOT", realpath(__DIR__.'/..'));
	define("NAME", basename($_SERVER['SCRIPT_NAME']));

	require_once ROOT."/etc/init.d/core.php";
	require_once ROOT."/lib/include/core.cli.php";

// -- CLASSES

	// Options container
	abstract class CLIOptions extends YacmsCLIOptions
	{
		/* Override for console options parent
		 * @return void
		 */
		public static function init()
		{
			self::$opts = array(
				"help"   => array(
					"value" => false,
					"short" => 'h',
					"desc"  => 'Show this help',
				),
				"verbose" => array(
					"value" => false,
					"short" => 'v',
					"desc"  => 'Talkative mode',
				),
				"command" => array(
					"value" => null
				),
				"params"  => array(
					"value" => array()
				),
			);

			self::$info = array(
				"name" => NAME,
				"head" =>
					'PWF deploy manager'.NL.
					'Script allowing you to upload your local system version on other environments.'.NL.
					'All necessary informations are read from yacms settings'.NL,

				"foot" => '',
			);
		}
	}


	abstract class CLICommands extends YacmsCLICommands
	{

		public static function __callStatic($env, $args)
		{
			$env == 'run' && give_up("Please enter existing environment or --help for more info");

			System\Settings::env_exists($env) ?
				self::deploy($env):
				give_up("Environment does not exist. Try entering better one or --help for more info");
		}

			return !trim(shell_exec("ncftpls -u ${user} -p ${pass} ftp://${host} | grep ncftpls | wc -l"));
		}
	}




// -- RUNTIME

System\Init::cli();
